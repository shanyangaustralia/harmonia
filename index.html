<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Harmonia ‚Ä¢ Adaptive Music Therapy (YouTube + Shuffle)</title>
<style>
  :root{
    --bg1:#5b2bbf;
    --bg2:#9f7aea;
    --text:#f6f3ff;
    --muted:#cfc6ff;
    --accent:#ffd166;
    --accent2:#5df2d6;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;
    color:var(--text);
    background:
      radial-gradient(1200px 700px at 10% 10%, var(--bg2), transparent 60%),
      radial-gradient(1200px 700px at 90% 0%, var(--bg1), transparent 60%),
      linear-gradient(160deg, var(--bg1) 0%, #120a27 60%);
    transition:background 0.6s ease;
  }
  .container{max-width:1100px;margin:0 auto;padding:24px}
  header{
    display:flex;align-items:center;justify-content:space-between;
    gap:16px;padding:12px 0;
  }
  .brand{display:flex;gap:12px;align-items:center}
  .logo{
    width:40px;height:40px;border-radius:50%;
    background:conic-gradient(from 120deg,var(--accent),var(--accent2),#a78bfa);
    box-shadow:0 0 12px #0004;
    transition:background 0.4s ease;
  }
  h1{margin:0;font-size:clamp(22px,4vw,32px)}
  .sub{color:var(--muted);font-size:14px;margin-top:4px}
  .card{
    background:#ffffff0a;border:1px solid #ffffff1a;border-radius:18px;padding:18px;
    backdrop-filter:blur(6px);box-shadow:0 6px 30px #0003;
  }
  .hero{display:grid;grid-template-columns:1fr;gap:18px}
  .btn{
    border:0;border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer;
    background:var(--accent);color:#1c1830;box-shadow:0 6px 20px #ffd16655;
    transition:transform .08s ease, box-shadow .2s ease, background .3s ease, color .3s ease;
    font-size:13px;
  }
  .btn:hover{transform:translateY(-1px);box-shadow:0 8px 24px #0004}
  .btn.secondary{
    background:#ffffff18;color:#ffffff;border:1px solid #ffffff33;box-shadow:none;
  }
  .btn.secondary:hover{background:#ffffff25}
  .btn.small-btn{padding:6px 10px;font-size:12px;border-radius:999px}
  .chip{
    border:1px solid #ffffff33;background:#ffffff18;color:#f6f3ff;
    padding:8px 12px;border-radius:999px;cursor:pointer;font-size:13px;
    transition:background .2s ease,color .2s ease,border-color .2s ease;
  }
  .chip[data-active="true"]{background:var(--accent2);color:#10221d;border-color:transparent}
  .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  .moods,.rating{display:flex;gap:10px;flex-wrap:wrap}
  .pill{
    padding:6px 10px;border-radius:999px;background:#ffffff12;border:1px solid #ffffff33;
    font-size:12px;color:var(--muted);
  }
  .small{font-size:12px;color:#cfc6ff}
  .hidden{display:none!important}
  iframe{width:100%;height:420px;border:0;border-radius:12px;background:#000}
  p, ul{font-size:13px;color:#e7e0ff;line-height:1.6}
  ul{margin:6px 0 0 20px;padding:0}
</style>
</head>
<body>
<div class="container">
  <header>
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <h1>Harmonia</h1>
        <div class="sub">Adaptive mood music, powered by YouTube playlists.</div>
      </div>
    </div>
    <div class="row">
      <span class="pill">Full mixes via YouTube üéµ ¬∑ Shuffle on every option</span>
      <button id="themeBtn" class="btn secondary small-btn">üé® Change theme</button>
    </div>
  </header>

  <!-- START A SESSION -->
  <section class="hero">
    <div class="card">
      <h2 style="margin:0">Start a session</h2>
      <p class="small">
        Pick a mood and click any button. Every click shuffles a new starting track for that mood.
      </p>
      <div id="moodChips" class="moods"></div>
      <div class="row" style="margin-top:8px">
        <button id="playBtn" class="btn">‚ú® Load Session</button>
        <button id="resumeBtn" class="btn secondary hidden">‚èÆ Resume last session</button>
      </div>
    </div>
  </section>

  <!-- NOW PLAYING -->
  <section id="results" style="margin-top:18px" class="card">
    <div class="row" style="justify-content:space-between">
      <h2 style="margin:0">Now Playing</h2>
      <div class="row">
        <button id="saveBtn" class="btn secondary">üíæ Save session</button>
        <a id="openLink" class="btn secondary" href="https://music.youtube.com" target="_blank" rel="noopener">
          Open externally
        </a>
      </div>
    </div>
    <div id="embedWrap" style="margin-top:10px"></div>
    <p id="hint" class="small" style="margin-top:6px"></p>
  </section>

  <!-- FEEDBACK -->
  <section id="feedback" class="card hidden" style="margin-top:14px">
    <div class="row" style="justify-content:space-between">
      <h3 style="margin:0">How did that feel?</h3>
      <span class="small">Each option shuffles to a different starting track for this mood.</span>
    </div>
    <div class="rating" style="margin-top:8px">
      <button class="btn" data-rate="good">üëç Good</button>
      <button class="btn secondary" data-rate="moderate">üòê Moderate</button>
      <button class="btn secondary" data-rate="bad">üëé Not for me</button>
    </div>
    <p id="fbMsg" class="small" style="margin-top:8px"></p>
  </section>

  <!-- WHY THIS HELPS ‚Äî ASMR-STYLE + PLAY BUTTON -->
  <section class="card" style="margin-top:14px">
    <div class="row" style="justify-content:space-between;align-items:center">
      <h3 style="margin:0">Why this helps</h3>
      <button id="playAsmrBtn" class="btn secondary small-btn">üîä Play soft narration</button>
    </div>

    <p style="margin-top:10px;">
      Just take a moment‚Ä¶ right here‚Ä¶ with me.  
      Let everything around you soften for a bit.  
      Harmonia isn‚Äôt about doing something ‚Äúright.‚Äù  
      It‚Äôs simply here to guide you back into yourself‚Ä¶ gently‚Ä¶ quietly.
    </p>

    <p>
      When you slow your breathing, even just a little, your body understands.  
      It hears the message: ‚ÄúYou can rest now.‚Äù  
      Try it softly‚Ä¶ a gentle inhale for four‚Ä¶  
      hold for seven‚Ä¶  
      and let the breath fall out for eight‚Ä¶  
      like a slow whisper drifting away.
    </p>

    <p>
      The music helps carry you there.  
      Softer sounds wrap around your thoughts,  
      smoothing out the edges‚Ä¶  
      helping your mind settle into a calmer rhythm.  
      Brighter tracks bring back a bit of light,  
      a spark of energy‚Ä¶ a quiet lift.
    </p>

    <p>
      And you choosing the mood ‚Äî that‚Äôs important.  
      It gives your mind a direction,  
      a feeling to follow‚Ä¶ without forcing anything.  
      This space is yours‚Ä¶ gentle, warm, and unhurried.
    </p>

    <p>
      Let Harmonia be a soft pause in your day ‚Äî  
      a moment where you can breathe,  
      listen,  
      and let your whole body exhale.
    </p>
  </section>

  <footer style="text-align:center;margin:28px 0" class="small">
    ¬© Harmonia ‚Äî sessions and feedback are stored only on this device (localStorage).
  </footer>
</div>

<script>
/* ========= IDs from your links ========= */
const RELAX_CHANNEL_UPLOADS = "UUN3WUalyMFvV4z2bSEPjF9Q";
const RELAX_CHANNEL_URL     = "https://music.youtube.com/channel/UCN3WUalyMFvV4z2bSEPjF9Q";

const SLEEP_VIDEO_ID   = "yGi1MePEN-k";
const SLEEP_VIDEO_URL  = "https://music.youtube.com/watch?v=yGi1MePEN-k";

const MIX_UPLIFT = "RDCLAK5uy_n-yE4nMyeF6YgTQscr--yzCqcyxZeZlJ4";

/* ========= PRESETS ========= */
const presets = {
  relax: {
    base: { balanced:[{type:"playlist",id:RELAX_CHANNEL_UPLOADS,musicUrl:RELAX_CHANNEL_URL}] },
    good:[{type:"playlist",id:RELAX_CHANNEL_UPLOADS,musicUrl:RELAX_CHANNEL_URL}],
    moderate:[{type:"playlist",id:RELAX_CHANNEL_UPLOADS,musicUrl:RELAX_CHANNEL_URL}],
    bad:[{type:"playlist",id:RELAX_CHANNEL_UPLOADS,musicUrl:RELAX_CHANNEL_URL}]
  },

  focus: {
    base: {
      balanced:[
        {type:"playlist",id:"PLNIOIzEHtNJbXCOTAlbxazG1MwruX0Rg5"},
        {type:"playlist",id:"PLqeS6IFyLPkdXAcPU_sGhJEObT2gQODAb"}
      ]
    },
    good:[
      {type:"playlist",id:"PLNIOIzEHtNJbXCOTAlbxazG1MwruX0Rg5"},
      {type:"video",id:"DfSkKYQiwoU"}
    ],
    moderate:[
      {type:"video",id:"d7vbPEDfLc8"},
      {type:"video",id:"5OhPNn_tIyY"}
    ],
    bad:[
      {type:"video",id:"94oRUmQqQQ8"},
      {type:"video",id:"wreqz7dTGOk"}
    ]
  },

  energize: {
    base:{ balanced:[
      {type:"playlist",id:"PLEtgZKznQZq3gDLX0k8I_cxPfmQZeNo7s"},
      {type:"video",id:"8xDPdgAaE4o"}
    ]},
    good:[
      {type:"video",id:"k05N55YCw_g"},
      {type:"video",id:"3x9U3te83yk"},
      {type:"video",id:"8xDPdgAaE4o"}
    ],
    moderate:[
      {type:"playlist",id:"PLEtgZKznQZq3gDLX0k8I_cxPfmQZeNo7s"},
      {type:"playlist",id:"PL_rzAzPDIGoX53OjZ-ltGzBnPDGfFVkxe"}
    ],
    bad:[
      {type:"video",id:"94oRUmQqQQ8"},
      {type:"video",id:"QluZQaGJZ6A"}
    ]
  },

  uplift: {
    base:{ balanced:[{type:"playlist",id:MIX_UPLIFT}] },
    good:[{type:"playlist",id:MIX_UPLIFT}],
    moderate:[{type:"playlist",id:MIX_UPLIFT}],
    bad:[{type:"playlist",id:MIX_UPLIFT}]
  },

  sleep: {
    base:{ balanced:[{type:"video",id:SLEEP_VIDEO_ID,musicUrl:SLEEP_VIDEO_URL}] },
    good:[{type:"video",id:SLEEP_VIDEO_ID,musicUrl:SLEEP_VIDEO_URL}],
    moderate:[{type:"video",id:SLEEP_VIDEO_ID,musicUrl:SLEEP_VIDEO_URL}],
    bad:[{type:"video",id:SLEEP_VIDEO_ID,musicUrl:SLEEP_VIDEO_URL}]
  }
};

/* ========= FEEL-GOOD THEME PALETTES (warm + cool, ~50) ========= */

/* HSL -> HEX */
function hslToHex(h, s, l){
  s /= 100;
  l /= 100;
  const k = n => (n + h / 30) % 12;
  const a = s * Math.min(l, 1 - l);
  const f = n => {
    const c = l - a * Math.max(-1, Math.min(k(n) - 3, Math.min(9 - k(n), 1)));
    return Math.round(255 * c).toString(16).padStart(2, "0");
  };
  return `#${f(0)}${f(8)}${f(4)}`;
}

/* Generate palettes across several "feel good" buckets:
   - warm sunrise / sunset
   - mint / teal calm
   - sky blue
   - lavender / lilac
*/
function generateFeelGoodPalettes(count){
  const list = [];
  for(let i = 0; i < count; i++){
    const bucket = Math.floor(Math.random()*4);
    let baseHue;

    if(bucket === 0){          // warm sunrise / sunset
      baseHue = 10 + Math.random()*40;   // 10‚Äì50
    }else if(bucket === 1){    // mint / teal
      baseHue = 150 + Math.random()*30;  // 150‚Äì180
    }else if(bucket === 2){    // sky blue
      baseHue = 195 + Math.random()*30;  // 195‚Äì225
    }else{                     // lavender / lilac
      baseHue = 260 + Math.random()*30;  // 260‚Äì290
    }

    const bg1 = hslToHex(baseHue,          45 + Math.random()*20, 35 + Math.random()*15);
    const bg2 = hslToHex(baseHue + 10,     35 + Math.random()*20, 60 + Math.random()*15);
    const accent  = hslToHex(baseHue + 20, 60 + Math.random()*20, 55 + Math.random()*10);
    const accent2 = hslToHex(baseHue - 15, 60 + Math.random()*25, 65 + Math.random()*10);

    list.push({ bg1, bg2, accent, accent2 });
  }
  return list;
}

/* 6 curated + 44 generated = ~50 total feel-good themes */
let palettes = [
  { bg1:"#5b2bbf", bg2:"#9f7aea", accent:"#ffd166", accent2:"#5df2d6" }, // original purple
  { bg1:"#ff9a8b", bg2:"#ffecd2", accent:"#ffb347", accent2:"#ffd1dc" }, // peach sunrise
  { bg1:"#ff758c", bg2:"#ff7eb3", accent:"#ffd166", accent2:"#ff9f1c" }, // cozy sunset
  { bg1:"#3aafa9", bg2:"#def2f1", accent:"#ffe066", accent2:"#f6abb6" }, // soft teal calm
  { bg1:"#355c7d", bg2:"#6c5b7b", accent:"#f8b195", accent2:"#f67280" }, // forest dusk
  { bg1:"#d9a57c", bg2:"#f2e2d2", accent:"#ffcf6f", accent2:"#f8a5c2" }  // sand & rose
];

palettes = palettes.concat(generateFeelGoodPalettes(44));

let currentPaletteIndex = 0;

function applyPalette(p){
  const root = document.documentElement.style;
  root.setProperty("--bg1", p.bg1);
  root.setProperty("--bg2", p.bg2);
  root.setProperty("--accent", p.accent);
  root.setProperty("--accent2", p.accent2);
}

function changeTheme(){
  let next = currentPaletteIndex;
  while (palettes.length > 1 && next === currentPaletteIndex){
    next = Math.floor(Math.random() * palettes.length);
  }
  currentPaletteIndex = next;
  applyPalette(palettes[currentPaletteIndex]);
}

/* ========= HELPERS ========= */
const $ = s => document.querySelector(s);
const state = { mood:"relax", lastPlayed:{} };

function shufflePick(arr, key){
  if(!arr || arr.length === 0) return null;
  const last = state.lastPlayed[key];
  let choice;
  do { choice = arr[Math.floor(Math.random()*arr.length)]; }
  while(arr.length>1 && choice===last);
  state.lastPlayed[key] = choice;
  return choice;
}

function buildEmbed(item){
  if(item.type==="playlist"){
    const index=Math.floor(Math.random()*40);
    return {
      embed:`https://www.youtube.com/embed/videoseries?list=${item.id}&index=${index}&autoplay=1`,
      openYt:`https://www.youtube.com/playlist?list=${item.id}`,
      openYtm:item.musicUrl || `https://music.youtube.com/playlist?list=${item.id}`
    };
  }
  return {
    embed:`https://www.youtube.com/embed/${item.id}?autoplay=1`,
    openYt:`https://www.youtube.com/watch?v=${item.id}`,
    openYtm:item.musicUrl || `https://music.youtube.com/watch?v=${item.id}`
  };
}

function embedFromList(list,key){
  const item=shufflePick(list,key);
  if(!item) return;
  const {embed,openYt,openYtm}=buildEmbed(item);
  $("#embedWrap").innerHTML=`
    <iframe src="${embed}" allow="autoplay; encrypted-media; picture-in-picture" allowfullscreen></iframe>
    <p class="small">
      If playback is restricted in your region,
      <a href="${openYt}" target="_blank" rel="noopener">open on YouTube</a> or
      <a href="${openYtm}" target="_blank" rel="noopener">YouTube Music</a>.
    </p>`;
  $("#openLink").href=openYtm;
}

/* ========= SAVE & RESUME ========= */
function saveSession(){
  localStorage.setItem("harmonia_last_session", JSON.stringify({
    mood: state.mood,
    ts: new Date().toISOString()
  }));
  $("#fbMsg").textContent="Session saved on this device.";
}

function setupResume(){
  const raw=localStorage.getItem("harmonia_last_session");
  if(!raw) return;
  let data;
  try{ data=JSON.parse(raw); }catch(e){return;}
  const btn=$("#resumeBtn");
  btn.classList.remove("hidden");
  btn.onclick=()=>{
    if(data.mood){ state.mood=data.mood; renderMoods(); }
    loadBase();
  };
}

/* ========= ASMR NARRATION ========= */
const asmrText = `
Just take a moment‚Ä¶ right here‚Ä¶ with me.
Let everything around you soften for a bit.
Harmonia isn‚Äôt about doing something ‚Äúright.‚Äù
It‚Äôs simply here to guide you back into yourself‚Ä¶ gently‚Ä¶ quietly.

When you slow your breathing, even just a little, your body understands.
It hears the message: You can rest now.
Try it softly‚Ä¶ a gentle inhale for four‚Ä¶
hold for seven‚Ä¶
and let the breath fall out for eight‚Ä¶
like a slow whisper drifting away.

The music helps carry you there.
Softer sounds wrap around your thoughts,
smoothing out the edges,
helping your mind settle into a calmer rhythm.
Brighter tracks bring back a bit of light,
a spark of energy‚Ä¶ a quiet lift.

And you choosing the mood ‚Äî that‚Äôs important.
It gives your mind a direction,
a feeling to follow‚Ä¶ without forcing anything.
This space is yours‚Ä¶ gentle, warm, and unhurried.

Let Harmonia be a soft pause in your day ‚Äî
a moment where you can breathe,
listen,
and let your whole body exhale.
`;

function playAsmr(){
  if(!("speechSynthesis" in window)){
    alert("Audio narration is not supported in this browser.");
    return;
  }
  window.speechSynthesis.cancel();
  const u = new SpeechSynthesisUtterance(asmrText);
  u.rate = 0.85;
  u.pitch = 1;
  u.volume = 0.9;
  window.speechSynthesis.speak(u);
}

/* ========= UI / LOGIC ========= */
function renderMoods(){
  const wrap=$("#moodChips");
  wrap.innerHTML="";
  ["relax","focus","energize","uplift","sleep"].forEach(id=>{
    const b=document.createElement("button");
    b.className="chip";
    b.textContent=id[0].toUpperCase()+id.slice(1);
    b.onclick=()=>{
      state.mood=id;
      [...wrap.children].forEach(c=>c.dataset.active=String(c===b));
      changeTheme();     // üé® change colors with each mood click
      loadBase();        // üéµ then load new track for that mood
    };
    if(id===state.mood) b.dataset.active="true";
    wrap.appendChild(b);
  });
}

function loadBase(){
  const list=presets[state.mood].base.balanced;
  embedFromList(list,`base_${state.mood}`);
  $("#hint").textContent="Enjoy! Click any mood or feedback option to shuffle a new starting track.";
  $("#feedback").classList.remove("hidden");
}

function adapt(sentiment){
  const list=presets[state.mood][sentiment];
  embedFromList(list,`fb_${state.mood}_${sentiment}`);
  $("#hint").textContent =
    sentiment==="good" ? "Nice ‚Äî we‚Äôve leaned further into that vibe üé∂" :
    sentiment==="moderate" ? "Tweaked the style slightly for you." :
    "Switched things up with a different flavor.";
  const key="harmonia_feedback_youtube";
  const hist=JSON.parse(localStorage.getItem(key)||"[]");
  hist.push({ts:new Date().toISOString(),mood:state.mood,sentiment});
  localStorage.setItem(key,JSON.stringify(hist));
  $("#fbMsg").textContent="Feedback saved locally.";
}

/* ========= INIT ========= */
applyPalette(palettes[0]);   // initial theme
renderMoods();
$("#playBtn").addEventListener("click",()=>{
  changeTheme(); // change theme when user hits Load Session too
  loadBase();
});
$("#saveBtn").addEventListener("click",saveSession);
document.querySelectorAll('[data-rate]').forEach(b=>{
  b.addEventListener("click",()=>adapt(b.dataset.rate));
});
setupResume();
$("#playAsmrBtn").addEventListener("click", playAsmr);
$("#themeBtn").addEventListener("click", changeTheme);
</script>
</body>
</html>
